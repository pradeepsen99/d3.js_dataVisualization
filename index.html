<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="d3-grid.js"></script>
    <style>
    body {
      font-family:"avenir next", Arial, sans-serif;
      font-size: 12px;
      color: #696969;
    }

    #play-button {
      position: absolute;
      top: 140px;
      left: 50px;
      background: #f08080;
      padding-right: 26px;
      border-radius: 3px;
      border: none;
      color: white;
      margin: 0;
      padding: 0 12px;
      width: 60px;
      cursor: pointer;
      height: 30px;
    }

    #play-button:hover {
      background-color: #696969;
    }    

    .point, .rect {
        fill: #222;
    }
    
    .ticks {
      font-size: 10px;
    }

    .track,
    .track-inset,
    .track-overlay {
      stroke-linecap: round;
    }

    .track {
      stroke: #000;
      stroke-opacity: 0.3;
      stroke-width: 10px;
    }

    .track-inset {
      stroke: #dcdcdc;
      stroke-width: 8px;
    }

    .track-overlay {
      pointer-events: stroke;
      stroke-width: 50px;
      stroke: transparent;
      cursor: crosshair;
    }

    .handle {
      fill: #fff;
      stroke: #000;
      stroke-opacity: 0.5;
      stroke-width: 1.25px;
    }
    </style>
</head>

<body onload='init()'>
<svg width=500 height=500></svg>
<script>
async function init() {
    var width = window.screen.width;
    var height = window.screen.height; 

    d3.select("svg")                           
        .attr("width", width)
        .attr("height", height);
    
    d3.csv("police_brut.csv").then(function(data) {
        /*d3.select("svg")
        .append('g')
            .attr("transform", "translate(" + 50 + "," + 50 + ")")
        .selectAll('picture')
            .data(data)
            .enter()
            .append('image')
                .attr('xlink:href', function (d) { return d.url_image; })
                .attr('width', 50)
                .attr('height', 50)
                .attr('x', function(d, i) {return 2*i;})
                .attr('y', function(d, i) {return 2*i;})
        */
        var rects = [];

        var width = 960,
            height = 500;

        var rectGrid = d3.grid()
            .bands()
            .size([360, 360])
            .padding([1, 1]);

        var svg = d3.select("svg")
            .attr('width', width)
            .attr('height', height)
            .append("g")
            .attr("transform", "translate(70,70)");

        var tick = setInterval(push, 0);

        function update() {
            var rect = svg.selectAll(".rect")
                .data(rectGrid(rects));
                    rect.enter().append("rect")
                        .attr('xlink:href', function (d, i) { return data[i].url_image; })
                        .attr("class", "rect")
                        .attr("width", rectGrid.nodeSize()[0])
                        .attr("height", rectGrid.nodeSize()[1])
                        .attr("transform", function(d) { return "translate(" + (d.x + 460)+ "," + d.y + ")"; })
                        .style("opacity", 1e-6);
                    rect.transition()
                        .attr("width", rectGrid.nodeSize()[0])
                        .attr("height", rectGrid.nodeSize()[1])
                        .attr("transform", function(d) { return "translate(" + (d.x + 460)+ "," + d.y + ")"; })
                        .style("opacity", 1);
                    rect.exit().transition()
                        .style("opacity", 1e-6)
                        .remove();
        }

        function push() {
            if (rects.length > 55) {
                clearInterval(tick);
            }
            rects.push({});
            update();
        }

        function pop() {
        rects.pop();
        update();

        }

    });
}
</script>
</body>
